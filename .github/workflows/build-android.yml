name: Build Android APK

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install buildozer cython kivy

    - name: Build APK with Buildozer
      run: |
        # Copy mobile game as main.py
        cp supertuxkart_mobile.py main.py
        
        # Build debug APK
        buildozer android debug
        
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: supertuxkart-mobile-apk
        path: bin/*.apk
        
    - name: Create Release
      if: github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v2
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: SuperTuxKart Mobile v1.0.${{ github.run_number }}
        files: bin/*.apk
        body: |
          SuperTuxKart Mobile - Android APK
          
          üèéÔ∏è **Features:**
          - 3-phase gameplay: Speed Circuit ‚Üí Arena Battle ‚Üí Final Showdown
          - Touch controls optimized for mobile
          - 6 powerup types with authentic physics
          - 5-8 minute gaming sessions perfect for ads
          
          üì± **Installation:**
          1. Download APK file
          2. Enable "Install from unknown sources" in Android settings
          3. Install and enjoy!
        draft: false
        prerelease: false